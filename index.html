<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—ç ´è¯‘ - æœ€ä½³çºªå½•æŒ‘æˆ˜</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f2f5; padding: 20px; }
        .main-layout { display: flex; gap: 20px; max-width: 900px; width: 100%; flex-wrap: wrap; justify-content: center; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        .record-panel { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 320px; min-height: 300px; }
        h1 { color: #333; font-size: 1.5rem; margin-top: 0; }
        .timer-display { font-size: 2.5rem; font-weight: bold; color: #95a5a6; margin: 10px 0; font-family: monospace; }
        .timer-active { color: #007bff; }
        .stats { margin-bottom: 1rem; color: #666; line-height: 1.6; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1.5rem; letter-spacing: 4px; text-align: center; }
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1.1rem; font-weight: bold; width: 100%; }
        .record-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        .record-table th, .record-table td { border-bottom: 1px solid #eee; padding: 10px 5px; text-align: left; }
        .best-label { font-size: 12px; background: #ffedcc; color: #d35400; padding: 2px 5px; border-radius: 4px; margin-left: 5px; }
        .success { color: #28a745; font-weight: bold; }
        #message { margin-top: 15px; font-weight: 500; }
        .clear-btn { color: #999; cursor: pointer; font-size: 12px; float: right; font-weight: normal; margin-top: 5px; }
        .clear-btn:hover { color: #dc3545; }
    </style>
</head>
<body>

<div class="main-layout">
    <div class="container">
        <h1>æ•°å­—ç ´è¯‘</h1>
        <div class="timer-display" id="timer">00:00.00</div>
        <div id="wait-hint" style="color:#e67e22; font-size:0.8rem; margin-bottom:10px;">ç­‰å¾…è¾“å…¥å¼€å§‹è®¡æ—¶...</div>
        
        <div class="stats">
            ç›®æ ‡éš¾åº¦: <strong><span id="current-len">1</span> ä½æ•°</strong><br>
            ç”Ÿå‘½ç‚¹æ•°: <span id="max-info">3</span> æ¬¡å°è¯•
        </div>
        
        <input type="text" id="guessInput" placeholder="åœ¨æ­¤è¾“å…¥..." autocomplete="off">
        <button onclick="checkGuess()">æäº¤æŒ‡ä»¤</button>
        <div id="message"></div>

        <div id="historyLog" style="margin-top:20px; font-size: 0.85rem; color: #777; border-top: 1px solid #eee; padding-top:10px;">
            <strong>å†å²å°è¯•ï¼š</strong>
        </div>
    </div>

    <div class="record-panel">
        <h3 style="margin:0">
            å„é•¿åº¦æœ€ä½³çºªå½•
            <span class="clear-btn" onclick="clearBestRecords()">[æ¸…ç©ºè®°å½•]</span>
        </h3>
        <table class="record-table">
            <thead>
                <tr>
                    <th>ä½æ•°</th>
                    <th>æœ€çŸ­è€—æ—¶</th>
                    <th>æ¬¡æ•°</th>
                </tr>
            </thead>
            <tbody id="record-body"></tbody>
        </table>
    </div>
</div>

<script>
    let currentLength = 1;
    let answer = "";
    let attempts = 0;
    let maxAttempts = 0;
    let startTime;
    let timerInterval;
    let isTimerRunning = false;
    let currentMs = 0; // è®°å½•å½“å‰æ¯«ç§’æ•°æ–¹ä¾¿æ¯”è¾ƒ

    const STORAGE_KEY = 'guess_number_best_scores';

    // æ ¼å¼åŒ–æ—¶é—´
    function formatTime(ms) {
        let minutes = Math.floor(ms / 60000);
        let seconds = Math.floor((ms % 60000) / 1000);
        let centiseconds = Math.floor((ms % 1000) / 10);
        return (minutes < 10 ? "0" : "") + minutes + ":" +
               (seconds < 10 ? "0" : "") + seconds + "." +
               (centiseconds < 10 ? "0" : "") + centiseconds;
    }

    // æ›´æ–°å¹¶ä¿å­˜æœ€ä½³çºªå½•
    function updateBestRecord(len, ms, tries) {
        let records = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
        
        // å¦‚æœè¯¥é•¿åº¦æ²¡æœ‰è®°å½•ï¼Œæˆ–è€…æ–°è®°å½•ç”¨æ—¶æ›´çŸ­ï¼Œåˆ™ä¿å­˜
        if (!records[len] || ms < records[len].ms) {
            records[len] = {
                timeStr: formatTime(ms),
                ms: ms,
                tries: tries
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
            return true; // ä»£è¡¨ç ´äº†çºªå½•
        }
        return false;
    }

    // æ¸²æŸ“æ¦œå•
    function renderRecords() {
        const tbody = document.getElementById('record-body');
        tbody.innerHTML = "";
        let records = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
        
        // è·å–æ‰€æœ‰ä½æ•°å¹¶æ’åº
        let keys = Object.keys(records).sort((a, b) => parseInt(a) - parseInt(b));
        
        keys.forEach(len => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><strong>${len}ä½</strong></td>
                <td class="success">${records[len].timeStr}</td>
                <td>${records[len].tries}æ¬¡</td>
            `;
            tbody.appendChild(row);
        });
    }

    function clearBestRecords() {
        if(confirm("ç¡®å®šæ¸…ç©ºæ‰€æœ‰æœ€ä½³çºªå½•å—ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY);
            renderRecords();
        }
    }

    function initGame() {
        clearInterval(timerInterval);
        isTimerRunning = false;
        attempts = 0;
        answer = "";
        if (currentLength >= 4){
            maxAttempts = currentLength * 2;
        }else{
            maxAttempts = 9;
        }
        
        answer += Math.floor(Math.random() * 9 + 1).toString();
        for (let i = 1; i < currentLength; i++) {
            answer += Math.floor(Math.random() * 10).toString();
        }

        document.getElementById('timer').innerText = "00:00.00";
        document.getElementById('timer').className = "timer-display";
        document.getElementById('wait-hint').style.visibility = "visible";
        document.getElementById('current-len').innerText = currentLength;
        document.getElementById('max-info').innerText = maxAttempts;
        document.getElementById('historyLog').innerHTML = "<strong>å†å²å°è¯•ï¼š</strong>";
        document.getElementById('message').innerText = "ç­‰å¾…è¾“å…¥...";
        document.getElementById('message').style.color = "#333";
        renderRecords();
    }

    function startTimerOnce() {
        if (!isTimerRunning) {
            isTimerRunning = true;
            startTime = Date.now();
            document.getElementById('timer').classList.add('timer-active');
            document.getElementById('wait-hint').style.visibility = "hidden";
            
            timerInterval = setInterval(() => {
                currentMs = Date.now() - startTime;
                document.getElementById('timer').innerText = formatTime(currentMs);
            }, 30);
        }
    }

    function checkGuess() {
        const inputField = document.getElementById('guessInput');
        const guess = inputField.value;
        const msgZone = document.getElementById('message');
        
        if (guess.length !== currentLength || isNaN(guess)) {
            msgZone.innerText = "âŒ æ ¼å¼ä¸ç¬¦";
            msgZone.style.color = "#dc3545";
            return;
        }

        attempts++;
        let remaining = maxAttempts - attempts;
        document.getElementById('max-info').innerText = Math.max(0, remaining);

        let correct = 0;
        let wrongPos = 0;
        let ansCount = Array(10).fill(0), guessCount = Array(10).fill(0), matched = Array(10).fill(0);

        for (let i = 0; i < currentLength; i++) {
            let a = answer[i], g = guess[i];
            ansCount[a]++;
            if (a === g) { correct++; matched[a]++; }
            else { guessCount[g]++; }
        }
        for (let i = 0; i < 10; i++) {
            wrongPos += Math.min(guessCount[i], ansCount[i] - matched[i]);
        }

        const log = document.createElement('div');
        log.innerText = `[${guess}] -> âœ…${correct} âš ï¸${wrongPos}`;
        document.getElementById('historyLog').prepend(log);

        if (correct === currentLength) {
            clearInterval(timerInterval);
            let isNewBest = updateBestRecord(currentLength, currentMs, attempts);
            
            msgZone.innerText = isNewBest ? "ğŸ”¥ ç ´çºªå½•äº†ï¼" : "ğŸ‰ ç ´è¯‘æˆåŠŸï¼";
            msgZone.style.color = "#28a745";
            
            currentLength++;
            setTimeout(initGame, 1500);
        } else if (remaining <= 0) {
            clearInterval(timerInterval);
            msgZone.innerText = "â˜¢ï¸ å¤±è´¥ï¼ç­”æ¡ˆ: " + answer;
            msgZone.style.color = "#dc3545";
            setTimeout(() => {
                if(confirm("æŒ‘æˆ˜ä¸­æ–­ï¼Œæ˜¯å¦ä»1ä½é‡æ–°å¼€å§‹ï¼Ÿ")) {
                    currentLength = 1;
                    initGame();
                }
            }, 500);
        }
        inputField.value = "";
        inputField.focus();
    }

    document.getElementById('guessInput').addEventListener('input', startTimerOnce);
    document.getElementById('guessInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkGuess();
    });

    initGame();
</script>

</body>
</html>



