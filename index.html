<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒœæ•°å­—è®¡æ—¶æŒ‘æˆ˜èµ›</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f2f5; padding: 20px; }
        .main-layout { display: flex; gap: 20px; max-width: 900px; width: 100%; flex-wrap: wrap; justify-content: center; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        .record-panel { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 300px; min-height: 300px; }
        h1 { color: #333; font-size: 1.5rem; margin-top: 0; }
        .timer-display { font-size: 2.5rem; font-weight: bold; color: #95a5a6; margin: 10px 0; font-family: monospace; transition: color 0.3s; }
        .timer-active { color: #007bff; } /* è®¡æ—¶å¼€å§‹åå˜è‰² */
        .stats { margin-bottom: 1rem; color: #666; line-height: 1.6; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1.5rem; letter-spacing: 4px; text-align: center; }
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1.1rem; font-weight: bold; }
        .record-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        .record-table th, .record-table td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; }
        .success { color: #28a745; font-weight: bold; }
        .waiting-msg { color: #e67e22; font-size: 0.8rem; font-style: italic; }
    </style>
</head>
<body>

<div class="main-layout">
    <div class="container">
        <h1>æ•°å­—ç ´è¯‘</h1>
        <div class="timer-display" id="timer">00:00.00</div>
        <div id="wait-hint" class="waiting-msg">ç­‰å¾…è¾“å…¥ä»¥å¼€å§‹è®¡æ—¶...</div>
        
        <div class="stats">
            éš¾åº¦ç³»æ•°: <strong><span id="current-len">1</span> ä½æ•°</strong><br>
            å‰©ä½™æœºä¼š: <span id="max-info">3</span> æ¬¡
        </div>
        
        <input type="text" id="guessInput" placeholder="åœ¨æ­¤è¾“å…¥..." autocomplete="off">
        <button onclick="checkGuess()">æäº¤ç ´è¯‘æŒ‡ä»¤</button>

        <div id="message" style="margin-top: 15px; min-height: 24px; font-weight: 500;"></div>

        <div class="history" id="historyLog" style="margin-top:20px; font-size: 0.85rem; color: #555;">
            <strong>æœ€è¿‘å°è¯•ï¼š</strong>
        </div>
    </div>

    <div class="record-panel">
        <h3 style="margin-top:0">é€šå…³è£èª‰æ¦œ</h3>
        <table class="record-table">
            <thead>
                <tr>
                    <th>é•¿åº¦</th>
                    <th>ç”¨æ—¶</th>
                    <th>å°è¯•</th>
                </tr>
            </thead>
            <tbody id="record-body"></tbody>
        </table>
    </div>
</div>

<script>
let currentLength = 1;
    let answer = "";
    let attempts = 0;
    let maxAttempts = 0;
    
    let startTime;
    let timerInterval;
    let isTimerRunning = false;

    // --- æ–°å¢ï¼šæœ¬åœ°ä¿å­˜é€»è¾‘ ---
    const STORAGE_KEY = 'guess_number_records';

    function saveRecord(len, time, tries) {
        // 1. è·å–ç°æœ‰è®°å½•
        let records = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
        // 2. æ·»åŠ æ–°è®°å½•
        records.push({ len, time, tries });
        // 3. å­˜å›æœ¬åœ°
        localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
    }

    function loadRecords() {
        const tbody = document.getElementById('record-body');
        tbody.innerHTML = ""; // æ¸…ç©ºå½“å‰æ˜¾ç¤º
        let records = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
        
        // å€’åºæ˜¾ç¤ºï¼Œæœ€æ–°çš„åœ¨ä¸Šé¢
        records.reverse().forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${item.len}ä½</td><td class="success">${item.time}</td><td>${item.tries}</td>`;
            tbody.appendChild(row);
        });
    }

    function clearLocalRecords() {
        if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è£èª‰è®°å½•å—ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY);
            loadRecords();
        }
    }
    // -----------------------

    function formatTime(ms) {
        let minutes = Math.floor(ms / 60000);
        let seconds = Math.floor((ms % 60000) / 1000);
        let centiseconds = Math.floor((ms % 1000) / 10);
        return (minutes < 10 ? "0" : "") + minutes + ":" +
               (seconds < 10 ? "0" : "") + seconds + "." +
               (centiseconds < 10 ? "0" : "") + centiseconds;
    }

    function initGame() {
        clearInterval(timerInterval);
        isTimerRunning = false;
        attempts = 0;
        answer = "";
        maxAttempts = currentLength * 3;
        
        answer += Math.floor(Math.random() * 9 + 1).toString();
        for (let i = 1; i < currentLength; i++) {
            answer += Math.floor(Math.random() * 10).toString();
        }

        document.getElementById('timer').innerText = "00:00.00";
        document.getElementById('timer').classList.remove('timer-active');
        document.getElementById('wait-hint').style.visibility = "visible";
        document.getElementById('current-len').innerText = currentLength;
        document.getElementById('max-info').innerText = maxAttempts;
        document.getElementById('historyLog').innerHTML = "<strong>æœ€è¿‘å°è¯•ï¼š</strong>";
        document.getElementById('message').innerText = "ç³»ç»Ÿå°±ç»ª";
        document.getElementById('message').style.color = "#333";
        
        // æ¯æ¬¡åˆå§‹åŒ–æ—¶åŠ è½½ä¸€æ¬¡æœ¬åœ°è®°å½•
        loadRecords();
    }

    function startTimerOnce() {
        if (!isTimerRunning) {
            isTimerRunning = true;
            startTime = Date.now();
            document.getElementById('timer').classList.add('timer-active');
            document.getElementById('wait-hint').style.visibility = "hidden";
            
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                document.getElementById('timer').innerText = formatTime(elapsed);
            }, 30);
        }
    }

    function checkGuess() {
        const inputField = document.getElementById('guessInput');
        const guess = inputField.value;
        const msgZone = document.getElementById('message');
        
        if (guess.length !== currentLength || isNaN(guess)) {
            msgZone.innerText = "æ ¼å¼é”™è¯¯ï¼";
            msgZone.style.color = "#dc3545";
            return;
        }

        attempts++;
        let remaining = maxAttempts - attempts;
        document.getElementById('max-info').innerText = Math.max(0, remaining);

        let correct = 0;
        let wrongPos = 0;
        let ansCount = Array(10).fill(0);
        let guessCount = Array(10).fill(0);
        let matchedInPos = Array(10).fill(0);

        for (let i = 0; i < currentLength; i++) {
            let a = parseInt(answer[i]);
            let g = parseInt(guess[i]);
            ansCount[a]++;
            if (a === g) {
                correct++;
                matchedInPos[a]++;
            } else {
                guessCount[g]++;
            }
        }

        for (let i = 0; i < 10; i++) {
            let remainingAns = ansCount[i] - matchedInPos[i];
            wrongPos += Math.min(guessCount[i], remainingAns);
        }

        const logItem = document.createElement('div');
        logItem.innerText = `[${guess}] -> âœ…${correct} âš ï¸${wrongPos}`;
        document.getElementById('historyLog').prepend(logItem);

        if (correct === currentLength) {
            clearInterval(timerInterval);
            const finalTime = document.getElementById('timer').innerText;
            msgZone.innerText = "ğŸ‰ æˆåŠŸç ´è¯‘ï¼";
            msgZone.style.color = "#28a745";
            
            // --- ä¿®æ”¹ï¼šä¿å­˜å¹¶é‡æ–°åŠ è½½è®°å½• ---
            saveRecord(currentLength, finalTime, attempts);
            loadRecords();
            // ----------------------------
            
            currentLength++;
            setTimeout(initGame, 1500);
        } else if (remaining <= 0) {
            clearInterval(timerInterval);
            msgZone.innerText = "â˜¢ï¸ å¤±è´¥ï¼ç­”æ¡ˆæ˜¯ " + answer;
            msgZone.style.color = "#dc3545";
            setTimeout(() => {
                if(confirm("æ¸¸æˆç»“æŸï¼é‡å¤´å¼€å§‹å—ï¼Ÿ")) {
                    currentLength = 1;
                    // æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬ä¸è‡ªåŠ¨æ¸…ç©º localStorageï¼Œé™¤éä½ æƒ³è®©ç©å®¶å¤±è´¥ä¹Ÿä¸¢è®°å½•
                    initGame();
                }
            }, 500);
        }
        
        inputField.value = "";
        inputField.focus();
    }

    document.getElementById('guessInput').addEventListener('input', startTimerOnce);
    document.getElementById('guessInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkGuess();
    });

    initGame();
</script>

</body>
</html>
